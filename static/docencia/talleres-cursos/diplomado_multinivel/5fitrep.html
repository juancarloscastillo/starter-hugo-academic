<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>5fitrep.knit</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="https://multinivel.netlify.com/docpres/xaringan_custom/xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="https://multinivel.netlify.com/docpres/xaringan_custom/progress-bar.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: bottom, right, inverse





&lt;!---
Para correr en ATOM
- open terminal, abrir R (simplemente, R y enter)
- rmarkdown::render('static/docpres/02_bases/2mlmbases.Rmd', 'xaringan::moon_reader')

About macros.js: permite escalar las imágenes como [scale 50%](path to image), hay si que grabar ese archivo js en el directorio.
---&gt;

.pull-left[.center[
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
![:scale 70%](https://multinivel.netlify.com/images/hex_eic2.png)]]

.pull-right[
# Modelos Multinivel
### Juan Carlos Castillo
### Sociología FACSO - UChile
### 2do Sem 2019
### [Diplomado Análisis Multivariable](https://juancarloscastillo.github.io/jc-castillo/documents/diplomado_multinivel/mlm-dip.html)

&lt;br&gt;

## Sesión 5: Ajuste y reporte
]

---
class: roja, middle, center

# Resumen sesión anterior

---
# Modelo con coeficientes aleatorios
&lt;br&gt;

![](images/raneffects.JPG)

---
# Modelo con coeficientes aleatorios

-   A partir de la estimación del modelo, es posible predecir el valor
    de los efectos aleatorios ( `\(\mu\)` ) para cada unidad de nivel 2

-   Para el intercepto `\(\gamma_{00}\)`: `\(\mu_{01},\mu_{02},\mu_{03} ... \mu_{0j}\)`

-   Para la pendiente `\(\gamma_{10}\)` : `\(\mu_{11},\mu_{12},\mu_{13} ... \mu_{1j}\)`

-   Para la pendiente `\(\gamma_{20}\)` : `\(\mu_{21},\mu_{22},\mu_{23} ... \mu_{2j}\)`

---


.pull-left[
# Ej.estimación de pendiente aleatoria
]

.pull-right[
.small[

&lt;table cellspacing="0" align="center" style="border: none;"&gt;
&lt;caption align="top" style="margin-bottom:0.3em;"&gt;Modelo con SES aleatorio&lt;/caption&gt;
&lt;tr&gt;
&lt;th style="text-align: left; border-top: 2px solid black; border-bottom: 1px solid black; padding-right: 12px;"&gt;&lt;b&gt;&lt;/b&gt;&lt;/th&gt;
&lt;th style="text-align: left; border-top: 2px solid black; border-bottom: 1px solid black; padding-right: 12px;"&gt;&lt;b&gt;Model 1&lt;/b&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;(Intercept)&lt;/td&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;12.65&lt;sup style="vertical-align: 0px;"&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;&lt;/td&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;(0.21)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;ses&lt;/td&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;2.16&lt;sup style="vertical-align: 0px;"&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;&lt;/td&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;(0.12)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;female&lt;/td&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;-1.19&lt;sup style="vertical-align: 0px;"&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;&lt;/td&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;(0.16)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;mnses&lt;/td&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;3.07&lt;sup style="vertical-align: 0px;"&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;&lt;/td&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;(0.38)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;sector&lt;/td&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;1.43&lt;sup style="vertical-align: 0px;"&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;&lt;/td&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;(0.30)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="border-top: 1px solid black;"&gt;AIC&lt;/td&gt;
&lt;td style="border-top: 1px solid black;"&gt;46514.33&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;BIC&lt;/td&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;46576.24&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;Log Likelihood&lt;/td&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;-23248.16&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;Num. obs.&lt;/td&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;7185&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;Num. groups: schoolid&lt;/td&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;160&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;Var: schoolid (Intercept)&lt;/td&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;2.22&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;Var: schoolid ses&lt;/td&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;0.42&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;Cov: schoolid (Intercept) ses&lt;/td&gt;
&lt;td style="padding-right: 12px; border: none;"&gt;0.27&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="border-bottom: 2px solid black;"&gt;Var: Residual&lt;/td&gt;
&lt;td style="border-bottom: 2px solid black;"&gt;36.59&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-right: 12px; border: none;" colspan="3"&gt;&lt;span style="font-size:0.8em"&gt;&lt;sup style="vertical-align: 0px;"&gt;***&lt;/sup&gt;p &amp;lt; 0.001, &lt;sup style="vertical-align: 0px;"&gt;**&lt;/sup&gt;p &amp;lt; 0.01, &lt;sup style="vertical-align: 0px;"&gt;*&lt;/sup&gt;p &amp;lt; 0.05. SE en paréntesis&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
]
]
---
## Ej.estimación de coeficientes aleatorios (medias posteriores)


```r
coef(results_4)
```

```
## $schoolid
##      (Intercept)      ses    female   mnses   sector
## 1224   12.718688 2.229928 -1.185924 3.07283 1.429747
## 1288   13.118254 2.315323 -1.185924 3.07283 1.429747
## 1296   11.049900 1.893727 -1.185924 3.07283 1.429747
## 1308   12.338591 2.009420 -1.185924 3.07283 1.429747
## 1317   11.563797 1.872895 -1.185924 3.07283 1.429747
## 1358   12.147338 2.404293 -1.185924 3.07283 1.429747
## 1374   11.261404 2.215734 -1.185924 3.07283 1.429747
## 1433   13.862506 2.379662 -1.185924 3.07283 1.429747
## 1436   13.677847 2.315760 -1.185924 3.07283 1.429747
## 1461   13.372596 2.834185 -1.185924 3.07283 1.429747
## 1462   12.237417 1.630519 -1.185924 3.07283 1.429747
## 1477   12.529403 1.938104 -1.185924 3.07283 1.429747
## 1499   11.454040 2.467499 -1.185924 3.07283 1.429747
## 1637   12.006810 2.298976 -1.185924 3.07283 1.429747
## 1906   12.533231 2.120530 -1.185924 3.07283 1.429747
## 1909   13.240021 2.296086 -1.185924 3.07283 1.429747
## 1942   14.193660 2.347177 -1.185924 3.07283 1.429747
## 1946   13.279340 2.399089 -1.185924 3.07283 1.429747
## 2030   11.377733 1.835520 -1.185924 3.07283 1.429747
## 2208   12.493501 2.191759 -1.185924 3.07283 1.429747
## 2277   12.235888 1.186028 -1.185924 3.07283 1.429747
## 2305   13.404714 1.442942 -1.185924 3.07283 1.429747
## 2336   14.155767 2.337910 -1.185924 3.07283 1.429747
## 2458   12.572619 2.304372 -1.185924 3.07283 1.429747
## 2467   12.553604 2.254845 -1.185924 3.07283 1.429747
## 2526   14.521539 2.081324 -1.185924 3.07283 1.429747
## 2626   13.852562 2.481026 -1.185924 3.07283 1.429747
## 2629   13.734021 1.793893 -1.185924 3.07283 1.429747
## 2639   12.054817 1.724141 -1.185924 3.07283 1.429747
## 2651   11.764077 2.400970 -1.185924 3.07283 1.429747
## 2655   16.035512 2.674553 -1.185924 3.07283 1.429747
## 2658   11.059088 1.938731 -1.185924 3.07283 1.429747
## 2755   12.347354 1.858877 -1.185924 3.07283 1.429747
## 2768   12.174405 2.338538 -1.185924 3.07283 1.429747
## 2771   13.980828 2.501683 -1.185924 3.07283 1.429747
## 2818   13.570566 2.370264 -1.185924 3.07283 1.429747
## 2917   12.573740 1.848210 -1.185924 3.07283 1.429747
## 2990   13.342024 2.145252 -1.185924 3.07283 1.429747
## 2995   11.838660 1.850906 -1.185924 3.07283 1.429747
## 3013   13.160223 2.400036 -1.185924 3.07283 1.429747
## 3020   12.865964 2.075182 -1.185924 3.07283 1.429747
## 3039   13.245543 2.325450 -1.185924 3.07283 1.429747
## 3088   12.332119 2.064017 -1.185924 3.07283 1.429747
## 3152   13.438322 2.396298 -1.185924 3.07283 1.429747
## 3332   12.123488 2.011861 -1.185924 3.07283 1.429747
## 3351   11.006787 2.015229 -1.185924 3.07283 1.429747
## 3377   12.371916 1.578023 -1.185924 3.07283 1.429747
## 3427   16.189039 2.113855 -1.185924 3.07283 1.429747
## 3498   12.338567 1.739255 -1.185924 3.07283 1.429747
## 3499   11.078267 1.728836 -1.185924 3.07283 1.429747
## 3533   10.892292 1.721764 -1.185924 3.07283 1.429747
## 3610   13.588966 2.422726 -1.185924 3.07283 1.429747
## 3657   13.581872 2.518576 -1.185924 3.07283 1.429747
## 3688   12.410368 2.046851 -1.185924 3.07283 1.429747
## 3705    9.515435 1.541705 -1.185924 3.07283 1.429747
## 3716   13.442287 2.982233 -1.185924 3.07283 1.429747
## 3838   13.973101 1.999673 -1.185924 3.07283 1.429747
## 3881   12.057814 2.124468 -1.185924 3.07283 1.429747
## 3967   13.500676 2.382283 -1.185924 3.07283 1.429747
## 3992   12.031843 1.832326 -1.185924 3.07283 1.429747
## 3999   12.322912 2.532469 -1.185924 3.07283 1.429747
## 4042   11.656947 1.896690 -1.185924 3.07283 1.429747
## 4173   12.163090 2.273549 -1.185924 3.07283 1.429747
## 4223   13.798733 2.279179 -1.185924 3.07283 1.429747
## 4253   10.273404 1.461998 -1.185924 3.07283 1.429747
## 4292   13.420117 1.637567 -1.185924 3.07283 1.429747
## 4325   13.792054 2.438777 -1.185924 3.07283 1.429747
## 4350   11.946850 2.348998 -1.185924 3.07283 1.429747
## 4383   12.062749 2.365468 -1.185924 3.07283 1.429747
## 4410   13.191939 2.287018 -1.185924 3.07283 1.429747
## 4420   14.621465 2.361761 -1.185924 3.07283 1.429747
## 4458   12.005552 1.980520 -1.185924 3.07283 1.429747
## 4511   13.402952 1.861434 -1.185924 3.07283 1.429747
## 4523    9.513791 1.917411 -1.185924 3.07283 1.429747
## 4530   12.023144 2.042287 -1.185924 3.07283 1.429747
## 4642   14.268713 2.533765 -1.185924 3.07283 1.429747
## 4868   10.512227 1.712426 -1.185924 3.07283 1.429747
## 4931   11.601200 1.753519 -1.185924 3.07283 1.429747
## 5192   10.930830 1.907021 -1.185924 3.07283 1.429747
## 5404   11.464347 1.780138 -1.185924 3.07283 1.429747
## 5619   12.303160 2.646535 -1.185924 3.07283 1.429747
## 5640   14.231149 2.534929 -1.185924 3.07283 1.429747
## 5650   13.273346 1.947294 -1.185924 3.07283 1.429747
## 5667   11.053304 2.163370 -1.185924 3.07283 1.429747
## 5720   13.088570 2.244200 -1.185924 3.07283 1.429747
## 5761   12.686967 2.367094 -1.185924 3.07283 1.429747
## 5762   11.490666 1.948480 -1.185924 3.07283 1.429747
## 5783   12.848013 2.277046 -1.185924 3.07283 1.429747
## 5815   12.018246 2.218960 -1.185924 3.07283 1.429747
## 5819   12.007924 2.047928 -1.185924 3.07283 1.429747
## 5838   13.232824 2.193121 -1.185924 3.07283 1.429747
## 5937   13.467194 2.217537 -1.185924 3.07283 1.429747
## 6074   14.411909 2.140286 -1.185924 3.07283 1.429747
## 6089   14.726282 2.339448 -1.185924 3.07283 1.429747
## 6144   11.821378 2.244576 -1.185924 3.07283 1.429747
## 6170   14.921393 2.646232 -1.185924 3.07283 1.429747
## 6291   13.439845 2.383177 -1.185924 3.07283 1.429747
## 6366   13.139159 2.085864 -1.185924 3.07283 1.429747
## 6397   14.096697 2.412982 -1.185924 3.07283 1.429747
## 6415   13.358783 2.500028 -1.185924 3.07283 1.429747
## 6443   12.111530 1.719363 -1.185924 3.07283 1.429747
## 6464   11.739236 2.018432 -1.185924 3.07283 1.429747
## 6469   12.987687 2.152797 -1.185924 3.07283 1.429747
## 6484   13.838982 1.939921 -1.185924 3.07283 1.429747
## 6578   14.056908 2.231729 -1.185924 3.07283 1.429747
## 6600   12.719872 2.703482 -1.185924 3.07283 1.429747
## 6808   11.072415 2.061460 -1.185924 3.07283 1.429747
## 6816   11.875889 1.859838 -1.185924 3.07283 1.429747
## 6897   13.583240 2.589229 -1.185924 3.07283 1.429747
## 6990    9.886787 1.730689 -1.185924 3.07283 1.429747
## 7011   13.074902 2.533965 -1.185924 3.07283 1.429747
## 7101   12.390930 2.019152 -1.185924 3.07283 1.429747
## 7172    9.723452 1.768357 -1.185924 3.07283 1.429747
## 7232   13.547272 2.656759 -1.185924 3.07283 1.429747
## 7276   12.911277 2.557707 -1.185924 3.07283 1.429747
## 7332   12.481961 2.178251 -1.185924 3.07283 1.429747
## 7341   11.645933 1.950030 -1.185924 3.07283 1.429747
## 7342   12.109755 1.945832 -1.185924 3.07283 1.429747
## 7345   12.058370 2.666148 -1.185924 3.07283 1.429747
## 7364   13.870748 2.074413 -1.185924 3.07283 1.429747
## 7635   12.921321 2.210800 -1.185924 3.07283 1.429747
## 7688   15.182217 2.186222 -1.185924 3.07283 1.429747
## 7697   14.036678 2.461218 -1.185924 3.07283 1.429747
## 7734   13.579474 2.775843 -1.185924 3.07283 1.429747
## 7890   11.620794 1.657940 -1.185924 3.07283 1.429747
## 7919   12.846154 2.366528 -1.185924 3.07283 1.429747
## 8009   10.782401 1.743695 -1.185924 3.07283 1.429747
## 8150   12.609378 1.822869 -1.185924 3.07283 1.429747
## 8165   13.203263 2.178620 -1.185924 3.07283 1.429747
## 8175   12.963808 2.083656 -1.185924 3.07283 1.429747
## 8188   12.842029 2.440730 -1.185924 3.07283 1.429747
## 8193   14.885212 2.355826 -1.185924 3.07283 1.429747
## 8202   12.206762 2.303005 -1.185924 3.07283 1.429747
## 8357   14.518478 2.443492 -1.185924 3.07283 1.429747
## 8367    9.107836 1.608686 -1.185924 3.07283 1.429747
## 8477   13.929579 2.607668 -1.185924 3.07283 1.429747
## 8531   12.233119 2.240760 -1.185924 3.07283 1.429747
## 8627   11.306052 1.965358 -1.185924 3.07283 1.429747
## 8628   15.640972 2.182031 -1.185924 3.07283 1.429747
## 8707   12.716847 2.446274 -1.185924 3.07283 1.429747
## 8775   11.959725 1.924073 -1.185924 3.07283 1.429747
## 8800   11.521896 2.237809 -1.185924 3.07283 1.429747
## 8854   10.184219 2.133731 -1.185924 3.07283 1.429747
## 8857   12.154898 1.879477 -1.185924 3.07283 1.429747
## 8874   14.087009 2.565375 -1.185924 3.07283 1.429747
## 8946   12.734504 1.998656 -1.185924 3.07283 1.429747
## 8983   12.882791 2.009176 -1.185924 3.07283 1.429747
## 9021   11.164565 1.905033 -1.185924 3.07283 1.429747
## 9104   12.411019 2.038344 -1.185924 3.07283 1.429747
## 9158   11.883105 2.536046 -1.185924 3.07283 1.429747
## 9198   14.173518 2.479962 -1.185924 3.07283 1.429747
## 9225   13.609250 2.412433 -1.185924 3.07283 1.429747
## 9292   13.249691 2.094634 -1.185924 3.07283 1.429747
## 9340   13.549198 2.294651 -1.185924 3.07283 1.429747
## 9347   12.299050 2.224249 -1.185924 3.07283 1.429747
## 9359   12.207862 1.649750 -1.185924 3.07283 1.429747
## 9397   10.960936 1.983996 -1.185924 3.07283 1.429747
## 9508   12.858864 2.363500 -1.185924 3.07283 1.429747
## 9550   12.042265 2.373925 -1.185924 3.07283 1.429747
## 9586   11.750845 1.908395 -1.185924 3.07283 1.429747
## 
## attr(,"class")
## [1] "coef.mer"
```

---
class: roja, middle, center

## Esta clase



# Ajuste modelos multinivel

# Reporte de resultados (1)

---
# Tipos de medidas de ajuste

1. Medidas relativas a la varianza de efectos aleatorios (tipo `\(R^2\)`)

2. Medidas de fit comparativo (deviance)

---
## 1. Ajuste por proporción de varianzas

![](images/var_pred.png)

---
## 1. Ajuste por proporción de varianzas

### Características ajuste por varianzas

-   Se relacionan con el grado de varianza “explicada” (disminución en la(s) varianza(s) atribuida a la inclusión de predictores en el modelo de regresión)

-   Controversia en la literatura de multinivel, no existe una medida única

-   Las propuestas sugieren usualmente cálculos de `\(R^2\)` para cada nivel

---
## 1. Ajuste por proporción de varianzas

### Bryk &amp; Raudenbusch `\(R^2\)` (1992, p.70)

`$$\begin{split}
    R_{BR}^2 Nivel1&amp;=[var_0(r_{ij})-var_f(r_{ij})]/var_0(r_{ij}) \\
    &amp;=[\sigma^2(0)-\sigma^2(f)]/\sigma^2(0)
    \end{split}$$`

--

`$$\begin{split}
    R_{BR}^2 Nivel2&amp;=[var_0(\mu_{0j})-var_f(\mu_{0j})]/var_0(\mu_{0j}) \\
    &amp;=[\tau_{00}(0)-\tau_{00}(f)]/\tau_{00}(0)
    \end{split}$$`

Donde:

-   `\(0\)` se refiere al modelo nulo
-   `\(f\)` se refiere a un modelo posterior

---
## 1. Ajuste por proporción de varianzas

### Ej. HSB Data

  | `\(\sigma^2\)`   | `\(\tau_{00}\)` |  `\(R^2_{L1}\)` |  `\(R^2_{L2}\)`
--|----------|-----|-----|--
Modelo 0                   |  39.148   | 8.614 |   |
Modelo 1 (predict.ind.)    |  36.148   |  3.93 | 0.076 |    |
Modelo 2 (predict.grup.)   |  39.161   |  2.31 |  0.00 |0.73 |

Ej: `\(R^2_{L2}=(8.614-2.31)/8.614=6.34/8.614=0.73\)`

-   Recordar interpretación en relación a correlación intra-clase (para
    el caso de HSB data= 0.18)

  -   Es decir, para el caso del R2 nivel 2 se está dando cuenta del 73%
    del 18%

---
## 2. Ajuste comparativo

### Deviance test

-   El test o estadístico de deviance **compara el ajuste** de dos modelos
    basado en la log verosimilitud de cada modelo

-   La hipótesis a contrastar es si predictores adicionales del modelo
    mejoran o no el ajuste

-   Asume que los **modelos son anidados**, es decir, que un modelo con
    menos predictores puede ser derivado del modelo mayor mediante la
    fijación de ciertos coeficientes como 0.

-   Deviance= `\(-2*LL\)` (LL=Log Likelihood)

-   Deviance test= `\(deviance(anidado)-deviance(mayor)\)`

---
## 2. Ajuste comparativo

### Deviance test

-   La distribución del estadístico de devianza es `\(\chi^2\)`, y los
    grados de libertad para calcular el valor crítico equivalen al
    número de parámetros extra en el modelo mayor

-   Es decir, parámetros modelo mayor - parámetros modelo inicial (o
    anterior)

-   Se utiliza con estimación ML en lugar de REML (restricted maximum likelihood).

---
## 2. Ajuste comparativo
### Ejemplo deviance



.small[


  | LL  | deviance | Parámetros
--|---|---|
results_0ml  | -23557.91 | 47115.81 |
results_1ml  | -23221.82 | 46443.64 | 2
]
-   Deviance test= 47115.8-46443.64= 672.16, 2 DF (2 parámetros
    adicionales)

-   Valor crítico `\(\chi^2_{DF=2}\)` para `\(p&lt;0.95=5.99\)`

-   Por lo tanto, se rechaza `\(H_0\)`, es decir, las diferencias entre los
    modelos son distintas de 0 ( `\(p&lt;0.05\)` ). En otras palabras, el modelo
    con más parámetros presenta un mejor ajuste.

---
## 2. Ajuste comparativo
### Ejemplo deviance II

... de manera directa en R:


```r
anova(results_0ml,results_1ml)
```

Y para reportar:

.small[

```r
print(xtable::xtable(anova(results_0ml,results_1ml)), type="html")
```

&lt;!-- html table generated in R 3.6.0 by xtable 1.8-4 package --&gt;
&lt;!-- Wed Oct  9 17:19:41 2019 --&gt;
&lt;table border=1&gt;
&lt;tr&gt; &lt;th&gt;  &lt;/th&gt; &lt;th&gt; Df &lt;/th&gt; &lt;th&gt; AIC &lt;/th&gt; &lt;th&gt; BIC &lt;/th&gt; &lt;th&gt; logLik &lt;/th&gt; &lt;th&gt; deviance &lt;/th&gt; &lt;th&gt; Chisq &lt;/th&gt; &lt;th&gt; Chi Df &lt;/th&gt; &lt;th&gt; Pr(&amp;gt;Chisq) &lt;/th&gt;  &lt;/tr&gt;
  &lt;tr&gt; &lt;td&gt; results_0ml &lt;/td&gt; &lt;td align="right"&gt; 3 &lt;/td&gt; &lt;td align="right"&gt; 47121.81 &lt;/td&gt; &lt;td align="right"&gt; 47142.45 &lt;/td&gt; &lt;td align="right"&gt; -23557.91 &lt;/td&gt; &lt;td align="right"&gt; 47115.81 &lt;/td&gt; &lt;td align="right"&gt;  &lt;/td&gt; &lt;td align="right"&gt;  &lt;/td&gt; &lt;td align="right"&gt;  &lt;/td&gt; &lt;/tr&gt;
  &lt;tr&gt; &lt;td&gt; results_1ml &lt;/td&gt; &lt;td align="right"&gt; 5 &lt;/td&gt; &lt;td align="right"&gt; 46453.64 &lt;/td&gt; &lt;td align="right"&gt; 46488.03 &lt;/td&gt; &lt;td align="right"&gt; -23221.82 &lt;/td&gt; &lt;td align="right"&gt; 46443.64 &lt;/td&gt; &lt;td align="right"&gt; 672.17 &lt;/td&gt; &lt;td align="right"&gt; 2 &lt;/td&gt; &lt;td align="right"&gt; 0.0000 &lt;/td&gt; &lt;/tr&gt;
   &lt;/table&gt;
]
---
## 2. Ajuste comparativo
### Deviance y pendiente aleatoria

-  Los test de ajuste por proporción de varianza no son recomendados al momento de estimar modelos con pendiente aleatoria

-   El test de deviance se utiliza al momento de reportar la significancia de los efectos aleatorios (ej: con pendiente aleatorio,comparando el mismo modelo con y sin aleatorización)

-   Considerar que los componentes de la varianza son parámetros del modelo, es decir, se cuentan para la diferencia de grados de libertad


---
class: roja, middle, center

# Reporte

---
## Tablas y descriptivos

-   Tabla de descriptivos de variables L1 y L2

-   Descripción del número de casos por escuela y también de otras    variables relevantes por escuela (ej, dependiente e independientes comprometidas en hipótesis)

---
## Tablas y descriptivos

### Ejemplo tabla descriptiva (Ferron et al 2007, en O’Connell Cap.11)

.center[![:scale 70%](images/descriptives.JPG)]

Alternativas en R: Stargazer, [summarytools](https://cran.r-project.org/web/packages/summarytools/vignettes/Introduction.html)

---
## Tablas/gráficos de correlaciones


```r
cormat=mlm %&gt;% select(mathach,ses,sector,size) %&gt;% cor()
corrplot::corrplot.mixed(cormat)
```

![](5fitrep_files/figure-html/unnamed-chunk-9-1.png)&lt;!-- --&gt;


---
## Nubes de puntos


![:scale 90%](images/xy1.jpeg)

---
## Nubes de puntos

![:scale 90%](images/xy2.jpeg)

---
## Nubes de puntos

![:scale 90%](images/xy3.jpeg)

---
## Nubes de puntos

![:scale 90%](images/xy4.jpeg)


---

### Reporte modelos

![image](images/models2.JPG)

(O’Connell, cap.11)
---
## Reporte modelos

![](images/models3.JPG)

---
## Reporte modelos

-   Efectos fijos, con valores t o se

-   Asteriscos para niveles de significación

-   Efectos aleatorios

-   Fit: log likelihood

-   Fit adicionales: AIC, BIC, deviance, R2

---
## Automatizando el reporte con RMarkdown

- Markdown es un lenguaje de escritura de texto simple, con pocas marcas de edición.

- RMarkdown es un formato que permite vincular escritura en Markdown y código de R, que luego son compilados en diferentes formatos de salida (pdf, html, word) mediante la librería knitr

![](https://es.r4ds.hadley.nz/images/RMarkdownFlow.png)


- Este proceso se encuentra automatizado en RStudio, mediante el uso del boton "Knitr", que realiza la compilación y muestra el output.

---
## Automatizando el reporte con RMarkdown

### Ventajas

- permite generar tablas y gráficos automáticamente en el mismo documento, evitando el cortar / pegar

- escritura simple

### Desventajas

- acostumbrarse

- conformarse con un formato simple de texto (al menos inicialmente)

- ... igual es R

.center[
# DE TODAS MANERAS VALE LA PENA
]

---

## RMarkdown

Tres cosas básicas a aprender:

- Markdown

- Insertar trozos (chunks) de código

- Opciones generales en encabezado YAML


## Varios tutoriales ... revisar

- Sección R Markdown de R4DS: https://es.r4ds.hadley.nz/r-markdown.html

- Guía de documentos dinámicos: https://juancarloscastillo.github.io/metsoc-facsouchile/documents/trabajos/guia_rep_dinamico/reportedinamico.html


---
## ... y en RStudio

![:scale 95%](https://juancarloscastillo.github.io/metsoc-facsouchile/documents/trabajos/guia_rep_dinamico/images/rmarkdown.gif)

---
## Y en general para la entrega de trabajos

- De preferencia en (R)Markdown, facilita la apertura y colaboración.

- Preocuparse más del contenido que del formato

- Tip importante para generar tablas:

  - hay que decidir de antemano si el formato de presentación será pdf o html. De preferencia html

  - en este caso, tener en consideración que se debe dar la opción html en la función o argumentos del comando.
      - Por ejemplo, en el caso de la librería `texreg`, para tablas de regresión, la función que se utiliza es `screenreg`

 - y para que las tablas se puedan visualizar bien, en el chunk donde se genera la tabla dar la opción results=`'asis'`




---
class: inverse

# Resumen Reporte

- Descriptivos por nivel

- correlaciones

- Scatters

- Tablas modelos

- Gráficos interacción (más adelante)

---
class: bottom, right, inverse

.pull-left[.center[
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
![:scale 70%](https://multinivel.netlify.com/images/hex_eic2.png)]]

.pull-right[
# Modelos Multinivel
### Juan Carlos Castillo
### Sociología FACSO - UChile
### 2do Sem 2019
### [multinivel.netlify.com](https://multinivel.netlify.com)
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://multinivel.netlify.com/docpres/xaringan_custom/macros.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "<div class=\"progress-bar-container\">\n  <div class=\"progress-bar\" style=\"width: calc(%current% / %total% * 100%);\">\n  </div>\n</div>`\n",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
